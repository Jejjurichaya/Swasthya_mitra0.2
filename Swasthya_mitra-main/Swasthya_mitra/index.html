<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ©º Swasthya Mitra - Premium Offline Health Assistant</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#667eea">
</head>
<body data-theme="light">
  <canvas id="particles" class="particles"></canvas>

  <header>
    <div class="header-row">
      <h1>ğŸ©º Swasthya Mitra</h1>
      <div class="header-controls">
        <button id="themeToggle" class="theme-toggle" title="Toggle Theme">ğŸŒ™</button>
      </div>
    </div>
    <p>Premium Offline Healthcare â€¢ English / [translate:à¤¹à¤¿à¤‚à¤¦à¥€] / [translate:à²•à²¨à³à²¨à²¡]</p>

    <!-- Navigation Menu -->
    <nav class="main-nav">
      <button class="nav-btn active" data-target="symptom-section">ğŸ” Check Symptoms</button>
      <button class="nav-btn" data-target="timetable-section">â° Timetable</button>
      <button class="nav-btn" data-target="tracker-section">ğŸ’Š Tracker & History</button>
      <button class="nav-btn" data-target="bmi-section">ğŸ“Š BMI</button>
    </nav>
  </header>

  <main class="container">
    <div id="loadingScreen" class="card" style="display:none; text-align:center;">
      <div class="loading"></div>
      <p style="margin-top:16px;">Loading Database...</p>
    </div>

    <!-- SYMPTOM / ANALYSIS SECTION -->
    <section id="symptom-section" class="card section">
      <label for="language" class="label-title">ğŸŒ Language:</label>
      <select id="language">
        <option value="en">ğŸ‡®ğŸ‡³ English</option>
        <option value="hi">ğŸ‡®ğŸ‡³ [translate:à¤¹à¤¿à¤‚à¤¦à¥€]</option>
        <option value="kn">ğŸ‡®ğŸ‡³ [translate:à²•à²¨à³à²¨à²¡]</option>
      </select>

      <div id="controls" class="controls-grid">
        <div class="mic-wrapper">
          <button id="micBtn" class="mic-btn"><span id="micIcon">ğŸ¤</span></button>
          <div id="micStatus" class="mic-status">Ready to listen</div>
        </div>

        <div class="text-controls">
          <input id="textInput" type="text" placeholder="ğŸ‘‰ Type symptoms or use voice..." />
          <div class="text-actions">
            <button id="textSubmit" class="btn">ğŸš€ Analyze</button>
            <label class="file-btn">ğŸ“¸ Upload Photo
              <input id="imageInput" type="file" accept="image/*" />
            </label>
          </div>
        </div>
      </div>

      <section id="preview" class="card" style="display:none;">
        <h3>ğŸ” AI Image Analysis</h3>
        <img id="imgPreview" alt="Medical image analysis" />
        <div id="imageAnalysis"></div>
      </section>

      <section id="output">
        <div id="transcript" class="transcript" style="display:none;"></div>
        <div id="diagnosis" style="display:none;" class="diagnosis"></div>

        <div id="ttsControls" class="tts-controls" style="display:none;">
          <button id="ttsToggleBtn" class="tts-btn">â¸ Pause</button>
          <button id="ttsStopBtn" class="tts-btn stop">â¹ Stop</button>
        </div>

        <div id="hospital-section" class="hospitals" style="display:none;">
          <h3>ğŸ¥ Nearest Hospitals</h3>
          <ul id="hospital-list"></ul>
        </div>
      </section>
    </section>

    <!-- TIMETABLE SECTION -->
    <section id="timetable-section" class="card section" style="display:none;">
      <h3>â° Medicine Timetable & Alarms</h3>
      <form id="scheduleForm" class="schedule-form">
        <input type="text" id="schedName" placeholder="Medicine name" required>
        <input type="time" id="schedTime" required>
        <label>Repeat:
          <select id="schedRepeat">
            <option value="daily">Daily</option>
            <option value="once">Once</option>
            <option value="custom">Custom</option>
          </select>
        </label>
        <div id="customDays" style="display:none;">
          <label><input type="checkbox" value="1">Mon</label>
          <label><input type="checkbox" value="2">Tue</label>
          <label><input type="checkbox" value="3">Wed</label>
          <label><input type="checkbox" value="4">Thu</label>
          <label><input type="checkbox" value="5">Fri</label>
          <label><input type="checkbox" value="6">Sat</label>
          <label><input type="checkbox" value="0">Sun</label>
        </div>
        <button type="submit" class="btn">â• Add Schedule</button>
      </form>
      <div id="schedulesList"></div>
    </section>

    <!-- ğŸ”” ALARM CONTROLS (Add this in timetable-section) -->
<div id="alarmControls" style="display:none; gap:16px; margin-top:20px; padding:16px; background:rgba(239,68,68,0.2); border-radius:12px; border:2px solid #ef4444;">
  <div id="alarmText" style="font-weight:600; color:#ef4444;"></div>
  <button id="stopAlarmBtn" class="btn" style="background:#ef4444; color:white;">ğŸ”• STOP ALARM</button>
</div>


    <!-- TRACKER SECTION -->
    <section id="tracker-section" class="card section" style="display:none;">
      <h3>ğŸ’Š Health Tracker</h3>
      <div class="tracker-grid">
        <div class="glass-card" onclick="showTracker('bp')"><div>ğŸ©¸ BP</div><div id="bpValue">-</div></div>
        <div class="glass-card" onclick="showTracker('sugar')"><div>ğŸ¬ Sugar</div><div id="sugarValue">-</div></div>
        <div class="glass-card" onclick="showTracker('weight')"><div>âš– Weight</div><div id="weightValue">-</div></div>
      </div>
      <input type="file" id="readingsUpload" accept=".csv,.json" style="display:none;">
      <button onclick="document.getElementById('readingsUpload').click()" class="btn" style="margin-top:16px;">ğŸ“¥ Upload Readings</button>
      <button id="downloadReport" class="btn" style="margin-top:8px;">ğŸ“„ Download Health Report</button>
    </section>

    <!-- BMI CALCULATOR SECTION (FIXED) -->
    <section id="bmi-section" class="card section" style="display:none;">
      <h2 style="text-align:center; margin-bottom:15px;">ğŸ“Š BMI Calculator</h2>
      <div class="bmi-container">
        <label>Weight (kg)</label>
        <input id="bmiWeight" type="number" class="input" placeholder="e.g. 70">

        <label style="margin-top:15px;">Height (cm)</label>
        <input id="bmiHeight" type="number" class="input" placeholder="e.g. 170">

        <button id="calcBMIbtn" class="btn">Calculate BMI</button>

        <div id="bmiResult" class="bmi-result"></div>
        <div id="bmiCategory" class="bmi-category"></div>

        <div class="bmi-bar-container">
          <div class="bmi-bar-bg">
            <div id="bmiBar" class="bmi-bar"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="muted small" style="text-align:center; padding:20px; opacity:0.7;">
    âœ¨ 100% Offline â€¢ AI-Powered â€¢ Rural Healthcare
  </footer>

  <!-- AUDIO FOR ALARMS -->
  <audio id="alarmAudio" src="icons/alarm-beep.mp3" preload="auto" loop></audio>

  <!-- LOAD APP + BMI + SERVICE WORKER -->
  <script src="app.js"></script>
  <script>
    // BMI Calculator (Fixed - matches HTML IDs)
    document.addEventListener("DOMContentLoaded", () => {
      const bmiHeight = document.getElementById("bmiHeight");
      const bmiWeight = document.getElementById("bmiWeight");
      const bmiResult = document.getElementById("bmiResult");
      const bmiCategory = document.getElementById("bmiCategory");
      const bmiBar = document.getElementById("bmiBar");
      const calcBMI = document.getElementById("calcBMIbtn");

      function calculateBMI(heightCm, weightKg) {
        if (!heightCm || !weightKg) return null;
        const h = heightCm / 100;
        const bmi = weightKg / (h * h);

        let category = "", color = "";
        if (bmi < 18.5) { category="Underweight"; color="#3b82f6"; }
        else if (bmi < 24.9) { category="Normal"; color="#16a34a"; }
        else if (bmi < 29.9) { category="Overweight"; color="#f59e0b"; }
        else { category="Obese"; color="#ef4444"; }

        return { bmiValue: bmi.toFixed(1), category, color };
      }

      calcBMI.addEventListener("click", () => {
        const h = parseFloat(bmiHeight.value);
        const w = parseFloat(bmiWeight.value);

        if (isNaN(h) || isNaN(w) || h <= 0 || w <= 0) {
          bmiResult.innerHTML = '<span style="color:#ef4444">Enter valid height & weight</span>';
          bmiCategory.innerHTML = "";
          bmiBar.style.width = "0%";
          return;
        }

        const result = calculateBMI(h, w);
        bmiResult.innerHTML = `<strong>BMI: ${result.bmiValue}</strong>`;
        bmiCategory.innerHTML = `<span style="color:${result.color}; font-weight:bold">${result.category}</span>`;
        bmiBar.style.width = Math.min(result.bmiValue * 3.5, 100) + "%";
        bmiBar.style.background = result.color;
      });
    });

    // Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js").catch(console.error);
    }
  </script>
</body>
</html>
